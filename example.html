<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Console – Tabbed</title>

    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #f7f8fa
        }

        header {
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6
        }

        .title {
            font-weight: 800;
            font-size: 1.25rem
        }

        .card {
            border-radius: 10px
        }

        .btn-wide {
            min-width: 140px
        }

        .empty {
            color: #6c757d
        }

        .small-help {
            color: #6c757d;
            font-size: .9rem
        }

        .nav-tabs .nav-link {
            font-weight: 600
        }
    </style>
</head>

<body>
    <header class="py-3">
        <div class="container d-flex align-items-center justify-content-between">
            <div class="title">Admin Console</div>
            <button class="btn btn-outline-secondary btn-sm">Log out</button>
        </div>
    </header>

    <main class="py-4">
        <div class="container">

            <!-- Tabs -->
            <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="cycle-tab" data-toggle="tab" href="#cycle" role="tab"
                        aria-controls="cycle" aria-selected="true">Cycle Schedule</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="templates-tab" data-toggle="tab" href="#templates" role="tab"
                        aria-controls="templates" aria-selected="false">Templates</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="staff-tab" data-toggle="tab" href="#staff" role="tab" aria-controls="staff"
                        aria-selected="false">Staff Sync</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="audit-tab" data-toggle="tab" href="#audit" role="tab" aria-controls="audit"
                        aria-selected="false">Audit Log</a>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content pt-3" id="adminTabsContent">

                <!-- Cycle Schedule -->
                <div class="tab-pane fade show active" id="cycle" role="tabpanel" aria-labelledby="cycle-tab">
                    <!-- Settings -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="mb-3">Cycle Settings</h5>

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label for="startDate">Start Date</label>
                                    <input id="startDate" type="date" class="form-control" autocomplete="off">
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="repeatWeeks">Repeat Rule (weeks)</label>
                                    <input id="repeatWeeks" type="number" min="1" step="1" value="2"
                                        class="form-control">
                                    <small class="small-help">End date = start + (weeks × 7 − 1) days.</small>
                                </div>
                                <div class="form-group col-md-4 d-flex align-items-end">
                                    <div class="btn-group w-100">
                                        <button id="btnReset" class="btn btn-warning btn-wide">Reset</button>
                                        <button id="btnSave" class="btn btn-primary btn-wide">Save Cycle</button>
                                    </div>
                                </div>
                            </div>

                            <div class="custom-control custom-switch mb-2">
                                <input type="checkbox" class="custom-control-input" id="cycleOpen" checked>
                                <label class="custom-control-label" for="cycleOpen"><span id="openLabel">Current Cycle:
                                        OPEN</span></label>
                            </div>

                            <hr>
                            <div class="d-flex align-items-center">
                                <div class="mr-3 text-muted">Summary:</div>
                                <div id="summary" class="font-weight-bold">—</div>
                            </div>
                        </div>
                    </div>

                    <!-- History -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <h5 class="mb-0 mr-auto">Cycle History</h5>
                                <button id="btnClear" class="btn btn-outline-danger btn-sm">Clear History</button>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-sm table-striped mb-0">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>#</th>
                                            <th>Start</th>
                                            <th>End (auto)</th>
                                            <th>Duration</th>
                                            <th>Weeks</th>
                                            <th>Open?</th>
                                            <th>Saved At</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="historyBody">
                                        <tr class="empty">
                                            <td colspan="8" class="text-center py-4">No cycles saved yet.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Templates -->
                <div class="tab-pane fade" id="templates" role="tabpanel" aria-labelledby="templates-tab">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="mb-3">Templates</h5>
                            <p class="text-muted mb-0">Add your message templates here.</p>
                        </div>
                    </div>
                </div>

                <!-- Staff Sync -->
                <div class="tab-pane fade" id="staff" role="tabpanel" aria-labelledby="staff-tab">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="mb-3">Staff Sync</h5>
                            <p class="text-muted mb-0">Connect and sync staff directories or CSV uploads.</p>
                        </div>
                    </div>
                </div>

                <!-- Audit Log -->
                <div class="tab-pane fade" id="audit" role="tabpanel" aria-labelledby="audit-tab">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="mb-3">Audit Log</h5>
                            <div class="table-responsive">
                                <table class="table table-sm table-striped mb-0" id="auditTable">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>User</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="auditBody">
                                        <!-- filled by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- /.tab-content -->
        </div>
    </main>

    <!-- jQuery + Popper + Bootstrap 4 JS (for working tabs) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <script>
        /* ===== minimal jQuery: just ready + one delegated handler ===== */
        $(function () {
            // ======= Cycle Schedule (vanilla JS with tiny helpers) =======
            const startEl = document.getElementById('startDate');
            const weeksEl = document.getElementById('repeatWeeks');
            const openEl = document.getElementById('cycleOpen');
            const openLbl = document.getElementById('openLabel');
            const summary = document.getElementById('summary');
            const tbody = document.getElementById('historyBody');
            const KEY = 'tabs_minjq_cycles';

            const pad = n => String(n).padStart(2, '0');
            const toYMD = d => `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
            function parseYMD(s) { if (!s) return null; const [y, m, d] = s.split('-').map(Number); if (!y || !m || !d) return null; return new Date(y, m - 1, d); }
            function addDays(d, n) { const x = new Date(d); x.setDate(x.getDate() + n); return x; }
            function calcEnd(s, w) { return addDays(s, w * 7 - 1); } // inclusive
            function human(d) { return new Intl.DateTimeFormat('en', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }).format(d); }
            function load() { try { return JSON.parse(localStorage.getItem(KEY) || '[]') } catch { return [] } }
            function save(list) { localStorage.setItem(KEY, JSON.stringify(list)); }

            function updateSummary() {
                const s = parseYMD(startEl.value);
                const w = Math.max(1, parseInt(weeksEl.value || '1', 10));
                if (!s) { summary.textContent = '—'; return; }
                const e = calcEnd(s, w);
                const days = Math.round((e - s) / 86400000) + 1;
                summary.textContent = `${human(s)} → ${human(e)} • ${days} days (${(days / 7).toFixed(2)} wk) • ${openEl.checked ? 'OPEN' : 'CLOSED'} • every ${w} wk`;
            }

            function render() {
                const list = load();
                tbody.innerHTML = '';
                if (!list.length) {
                    tbody.innerHTML = '<tr class="empty"><td colspan="8" class="text-center py-4">No cycles saved yet.</td></tr>';
                    return;
                }
                list.forEach((row, i) => {
                    const s = parseYMD(row.start), e = parseYMD(row.end);
                    const days = Math.round((e - s) / 86400000) + 1;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
        <td>${human(s)}</td>
        <td>${human(e)}</td>
        <td>${days} days</td>
        <td>${row.weeks}</td>
        <td>${row.open ? 'Yes' : 'No'}</td>
        <td>${new Date(row.savedAt).toLocaleString()}</td>
        <td class="text-right"><button class="btn btn-sm btn-outline-danger" data-id="${row.id}">Delete</button></td>
      `;
                    // add row number at runtime via CSS counters or keep simple: prepend number column (optional)
                    tbody.appendChild(tr);
                });
                // Re-number first column if you want an index column; keeping simple here.
            }

            // Field events (vanilla)
            startEl.addEventListener('change', updateSummary);
            weeksEl.addEventListener('input', () => { if (+weeksEl.value < 1) weeksEl.value = 1; updateSummary(); });
            openEl.addEventListener('change', () => { openLbl.textContent = `Current Cycle: ${openEl.checked ? 'OPEN' : 'CLOSED'}`; updateSummary(); });

            document.getElementById('btnReset').addEventListener('click', () => {
                startEl.value = ''; weeksEl.value = 2; openEl.checked = true; openLbl.textContent = 'Current Cycle: OPEN'; updateSummary();
            });

            document.getElementById('btnSave').addEventListener('click', () => {
                const s = parseYMD(startEl.value); if (!s) return alert('Please select a Start date.');
                const w = Math.max(1, parseInt(weeksEl.value || '1', 10));
                const e = calcEnd(s, w);
                const list = load();
                list.unshift({ id: Math.random().toString(36).slice(2), start: toYMD(s), end: toYMD(e), weeks: w, open: !!openEl.checked, savedAt: new Date().toISOString() });
                save(list); render();
            });

            document.getElementById('btnClear').addEventListener('click', () => {
                if (!confirm('Clear all history?')) return;
                localStorage.removeItem(KEY); render();
            });

            // Minimal jQuery: delegated delete button handler
            $('#historyBody').on('click', 'button[data-id]', function () {
                const id = this.getAttribute('data-id');
                const list = load().filter(x => x.id !== id);
                save(list); render();
            });

            // ======= Audit Log (simple demo data) =======
            const auditData = [
                { date: 'Aug 4', time: '20:45', user: 'Admin', action: 'Sent' },
                { date: 'Aug 3', time: '23:22', user: 'Ava', action: 'Edited' },
                { date: 'Aug 1', time: '12:56', user: 'Ava', action: 'Edited' }
            ];
            const auditBody = document.getElementById('auditBody');
            function renderAudit() {
                auditBody.innerHTML = '';
                auditData.forEach(r => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${r.date}<br>${r.time}</td><td>${r.user}</td><td>${r.action}</td>`;
                    auditBody.appendChild(tr);
                });
            }

            // Init
            render(); updateSummary(); renderAudit();

            // (Tabs work via Bootstrap’s data-toggle="tab"; no extra JS needed.)
        });
    </script>
</body>

</html>